/*! For license information please see 115.d3e655f3.chunk.js.LICENSE.txt */
(self.webpackChunktfjs_rl=self.webpackChunktfjs_rl||[]).push([[115],{71142:(e,t,s)=>{"use strict";s.d(t,{Zt:()=>R,xU:()=>C,aZ:()=>M});var a={};s.r(a),s.d(a,{Game:()=>p,GameContextRenderer:()=>x,GamePolicyNetwork:()=>g,GameTrainingPlan:()=>f,createGameContext:()=>y,createTrainable:()=>v});var n=s(20297);class i{constructor(e,t,s){if(this.numStates=t,this.numActions=s,e instanceof n.Gw9)this.model=e;else{let a=e;Array.isArray(a)||(a=[a]),this.model=n.ilg(),a.forEach(((e,s)=>{this.model.add(n.ZFI.dense({units:e,activation:"relu",inputShape:0===s?[t]:void 0}))})),this.model.add(n.ZFI.dense({units:s}))}}getGradientsAndAction(e,t,s,a){let i,o;return[n.y7e((()=>n.DZQ((()=>{const[r,l]=this.getLogitsAndAction(e,s),c=l.dataSync()[0];i=a(t,c),o=c;const d=n.Mw0(n.tGX([c],"int32"),this.numActions);return n.YYh.softmaxCrossEntropy(d,r).asScalar()})))).grads,i,o]}getLogitsAndAction(e,t){return n.DZQ((()=>{const s=this.model.predict(e),a=s.softmax(),i=a.clipByValue(1e-7,1-1e-7);let o=i;t&&(o=i.mul(t));0===o.sum().dataSync()[0]&&(o=n.tGX(t,"float32")),o=o.div(o.sum());const r=n.OjQ(o,1,void 0,!0),l=o.sum().dataSync()[0];if(t&&!t[r.dataSync()[0]]||isNaN(l)||l>1)throw console.log("@validActions",t),console.log("@clippedProbs",i.dataSync()),console.log("@probs2",o.dataSync()),console.log("@probs2Sum",l),console.log("@tf.multinomial(probs, 10, undefined, true)",n.OjQ(a,10,void 0,!0).toString()),console.log("@tf.multinomial(probs2, 10, undefined, true)",n.OjQ(o,10,void 0,!0).toString()),console.log("@action",r.toString()),new Error;return[s,r,i]}))}dispose(){this.model.dispose()}}class o extends i{async saveModel(){return await this.model.save(this.modelSavePath)}static async loadModel(e){const t=await n.io.listModels();if(e in t){console.log("Loading existing model...");const s=await n.O0W(e);return console.log("Loaded model from ".concat(e)),{info:t[e],model:s}}throw new Error("Cannot find model at ".concat(e,"."))}static async getModelInfo(e){const t=await n.io.listModels();if(e in t)return t[e];throw new Error("Cannot find model at ".concat(e,"."))}async removeModel(){return await n.io.removeModel(this.modelSavePath)}hiddenLayerSizes(){const e=[];for(let t=0;t<this.model.layers.length-1;++t)e.push(this.model.layers[t].units);return e}}const r=e=>{if(Array.isArray(e))return e.map((e=>r(e)));if(e.dataSync)return e.dataSync();if("number"===typeof e&&isNaN(e))throw new Error("NaN");return e?Object.entries(e).map((e=>{let[t,s]=e;return[t,r(s)]})).reduce(((e,t)=>({...e,[t[0]]:t[1]})),{}):e};class l{constructor(e){let{policy:t,discountRate:s,learningRate:a}=e;this.policy=t,this.discountRate=s,this.optimizer=n.BaG.adam(a),this.trajectories=[]}pushGradients(e,t){for(const s in t)s in e?e[s].push(t[s]):e[s]=[t[s]]}observe(e){return[e,null]}toEnvAction(e,t){return t}fromEnvAction(e,t){return t}async step(e,t,s,a){const[i,o,r]=n.DZQ((()=>{try{const e=n.KtR([t]);return this.policy.getGradientsAndAction(e,t,s,((e,t)=>this.toEnvAction(e,void 0!==a?a:t)))}catch(e){throw e}})),l=await e.step(o),c={inputs:t,validActions:s,action:void 0!==a?a:r,reward:l};return this.trajectory&&this.trajectory.push(c),n.ASo(i),c}addBonus(e){}beforeEpisode(){this.trajectory=[]}afterEpisode(e){e||(this.trajectories.push(this.trajectory),this.trajectory=[])}update(e,t){const s=[],a=[];for(let n=0;n<e.length;n++){const t=e[n],i=[],o=[];t.forEach(((e,t)=>{i.push(e.reward),e.real&&o.push(t)})),s.push(i),a.push(o)}e.length&&n.DZQ((()=>{const i=function(e,t){return n.DZQ((()=>{const s=[];for(const a of e)s.push(c(a,t));return s}))}(s,this.discountRate).map(((e,t)=>e.gather(a[t])));console.log("@rewardSequences",e),console.log("@realsList",a),console.log("@normalizedRewards",i);for(let e=0;e<this.trajectories.length;e++){const s=this.trajectories[e];if(console.log("@trajectory",e,s),0===s.length){t(e);continue}const a=()=>{const t=i[e],a=[],o=[],r=[],l=[],c=[],d=[],h=s.reduce(((e,t)=>{let{inputs:s,action:i,validActions:h}=t;const u=n.KtR([s]),[m,,p]=this.policy.getLogitsAndAction(u,h);a.push(i),o.push(p.dataSync());const g=p.log(),x=g.mul(p).sum().neg().reshape([-1]);return r.push(g.dataSync()),l.push(g.mul(p).dataSync()),c.push(g.mul(p).sum().dataSync()),d.push(g.mul(p).sum().neg().dataSync()),e[0].push(g.gather([i],1).reshape([-1])),e[1].push(x),e}),[[],[]]),u=n.xWs(h[0]),m=n.xWs(h[1]),p=n.OEK(.01);console.log(this.constructor.name,"@@@@actions",a),console.log(this.constructor.name,"@@@@probs",o),console.log(this.constructor.name,"@@@@log_probs",r),console.log(this.constructor.name,"@@@@ G",t.toString(),t.dataSync()),console.log(this.constructor.name,"@@@@logProbs",u.toString(),u.dataSync()),console.log(this.constructor.name,"@@@@entropies",m.toString(),m.dataSync());const g=t.mul(u).add(p.mul(m)).neg().mean().asScalar();return console.log(this.constructor.name,"@@@@loss",g.toString()),g},o=this.optimizer.computeGradients(a);console.log(this.constructor.name,"@@@computed",o.value.toString(),r(o.grads)),this.optimizer.applyGradients(o.grads),n.ASo(o.grads),t(e)}}));let i=0,o=0,l=0;return s.length>0&&n.DZQ((()=>{const e=[];for(let n=0;n<s.length;n++){const t=c(s[n],this.discountRate).gather(a[n]).sum(0,!0);e.push(t)}const t=n.xWs(e),r=n.i2o(t);i=r.dataSync()[0];const d=n.i2o(n.EwI(n.jbE(t,r))),h=n.RZD(d);o=h.dataSync()[0],l=d.dataSync()[0]})),this.trajectories=[],{rewardsPerEpisode:i,stdRewardsPerEpisode:o,varRewardsPerEpisode:l}}dispose(){this.policy.dispose(),this.optimizer.dispose()}}function c(e,t){const s=n.ra8([e.length]);let a=0;for(let n=e.length-1;n>=0;--n){const i=t*a+e[n];s.set(i,n),a=i}return s.toTensor()}class d{constructor(e){e||this.reset()}reset(){throw new Error("Implement required")}getState(){throw new Error("Implement required")}step(e){throw new Error("Implement required")}isDone(){throw new Error("Implement required")}render(e){throw new Error("Implement required")}}class h extends d{constructor(e){super(e),this.gravity=9.8,this.massCart=1,this.massPole=.1,this.totalMass=this.massCart+this.massPole,this.cartWidth=.2,this.cartHeight=.1,this.length=.5,this.poleMoment=this.massPole*this.length,this.forceMag=10,this.tau=.02,this.xThreshold=2.4,this.thetaThreshold=12/360*2*Math.PI}reset(){this.sharedData||(this.sharedData=new Float32Array(new SharedArrayBuffer(16)));const e=this.sharedData;this.data||(this.data={get x(){return e[0]},set x(t){e[0]=t},get xDot(){return e[1]},set xDot(t){e[1]=t},get theta(){return e[2]},set theta(t){e[2]=t},get thetaDot(){return e[3]},set thetaDot(t){e[3]=t}}),this.data.x=Math.random()-.5,this.data.xDot=1*(Math.random()-.5),this.data.theta=2*(Math.random()-.5)*(6/360*2*Math.PI),this.data.thetaDot=.5*(Math.random()-.5)}getState(){return[this.data.x,this.data.xDot,this.data.theta,this.data.thetaDot]}computeReward(){return this.isDone()?0:1}step(e){if(this.isDone())return 0;e<0&&(e=this.prevAction>-1?this.prevAction:Math.round(Math.random()));const t=e>0?this.forceMag:-this.forceMag,s=Math.cos(this.data.theta),a=Math.sin(this.data.theta),n=(t+this.poleMoment*this.data.thetaDot*this.data.thetaDot*a)/this.totalMass,i=(this.gravity*a-s*n)/(this.length*(4/3-this.massPole*s*s/this.totalMass)),o=n-this.poleMoment*i*s/this.totalMass;return this.data.x+=this.tau*this.data.xDot,this.data.xDot+=this.tau*o,this.data.theta+=this.tau*this.data.thetaDot,this.data.thetaDot+=this.tau*i,this.prevAction=e,this.computeReward()}isDone(){return this.data.x<-this.xThreshold||this.data.x>this.xThreshold||this.data.theta<-this.thetaThreshold||this.data.theta>this.thetaThreshold}render(e){e.style.display||(e.style.display="block");const t=-this.xThreshold,s=this.xThreshold-t,a=e.width/s,n=e.getContext("2d");n.clearRect(0,0,e.width,e.height);const i=e.width/2,o=.8*e.height,r=this.cartWidth*a,l=this.cartHeight*a,c=this.data.x*a+i;n.beginPath(),n.strokeStyle="#000000",n.lineWidth=2,n.rect(c-r/2,o-l/2,r,l),n.stroke();const d=l/4;for(const x of[-1,1])n.beginPath(),n.lineWidth=2,n.arc(c-r/4*x,o+l/2+d,d,0,2*Math.PI),n.stroke();const h=this.data.theta+Math.PI/2,u=i+a*(this.data.x+Math.cos(h)*this.length),m=o-a*(this.cartHeight/2+Math.sin(h)*this.length);n.beginPath(),n.strokeStyle="#ffa500",n.lineWidth=6,n.moveTo(c,o-l/2),n.lineTo(u,m),n.stroke();const p=o+l/2+2*d;n.beginPath(),n.strokeStyle="#000000",n.lineWidth=1,n.moveTo(0,p),n.lineTo(e.width,p),n.stroke();for(let x=0;x<40;++x){const t=e.width/40*x,s=t+e.width/40/2,a=p+e.width/40/2,i=p;n.beginPath(),n.moveTo(t,a),n.lineTo(s,i),n.stroke()}const g=p-e.height/2;n.beginPath(),n.strokeStyle="#ff0000",n.lineWidth=2,n.moveTo(1,p),n.lineTo(1,g),n.stroke(),n.beginPath(),n.moveTo(e.width-1,p),n.lineTo(e.width-1,g),n.stroke()}}h.NAME="cart-pole-v1";const u="indexeddb://".concat(h.NAME,"/");class m extends o{constructor(e,t,s,a){super(e,t,s),this.modelName=a,this.modelSavePath="".concat(u).concat(a,":").concat(t,"x").concat(this.hiddenLayerSizes(),"x").concat(s)}static async loadModel(e,t){const{info:s,model:a}=await o.loadModel(e),n=a.layers[0].batchInputShape[1],i=a.layers[a.layers.length-1].units;return{info:s,policy:new m(a,n,i,t)}}}const p=h,g=m,x=()=>null,y=e=>{const t={onBeforeIteration(){},onBeforeEpisode(){},onStep(){},onAfterEpisode(){},onAfterIteration(){},get(){}},s={onReset(){},onUpdate(e){},getPlot(){},get(){}};return{training:t,ui:s,get:()=>({...t.get(),...s.get()})}};class b extends l{}b.NUM_STATES=4,b.NUM_ACTIONS=2;const f={game:h.NAME,models:[{name:"main",states:b.NUM_STATES,actions:b.NUM_ACTIONS,discountRate:.98,learningRate:.029}],iterations:100,episodes:10,steps:500},v=(e,t)=>"main"===e?new b(t):null;var w=s(86112),S=s(6431),j=s(9950),N=s(44414);const k=e=>{let{envForRendering:t,trainer:s,plan:a,setPlan:i,GameContextRenderer:o,blockUI:r,setBlockUI:l}=e;const[c,d]=(0,j.useState)("Standing by."),[h,u]=(0,j.useState)(!1),[m,p]=(0,j.useState)("Step #:"),[g,x]=(0,j.useState)(0),[y,b]=(0,j.useState)("Episode #:"),[f,v]=(0,j.useState)(0),[k,E]=(0,j.useState)("Iteration #:"),[R,C]=(0,j.useState)("0"),[A,T]=(0,j.useState)("0"),[P,I]=(0,j.useState)("Learning #:"),[D,L]=(0,j.useState)(0),[B,G]=(0,j.useState)("0"),[z,O]=(0,j.useState)(0),U=(0,j.useCallback)(((e,t)=>{const s=M.models.map(((t,s)=>[t.name,e[s].action,e[s].reward]));d("Test in progress. Action: ".concat(JSON.stringify(s)," (Step ").concat(t,")"))}),[]),q=(0,j.useCallback)(((e,t)=>{p("Step ".concat(e," of ").concat(t)),x(e/t*100)}),[]),W=(0,j.useCallback)(((e,t)=>{b("Episode ".concat(e," of ").concat(t)),v(e/t*100)}),[]),Z=(0,j.useCallback)(((e,t)=>{E("Iteration ".concat(e," of ").concat(t)),O(e/t*100)}),[]),F=(0,j.useCallback)(((e,t)=>{I("Learning ".concat(e," of ").concat(t)),L(e/t*100),e===t&&I("Learning time:")}),[]),[Q,_]=(0,j.useState)(!1),[H,K]=(0,j.useState)(!1),[V,X]=(0,j.useState)(!1),[Y,J]=(0,j.useState)(!1),[$,ee]=(0,j.useState)(null),[te,se]=(0,j.useState)([]);(0,j.useEffect)((()=>{de(a.iterations),ue(a.episodes),pe(a.steps);const e=[];for(const s of a.models){var t;if(!((null===(t=s.hiddenLayerSizes)||void 0===t?void 0:t.length)>0))return void se([]);e.push({name:s.name,path:s.path,discountRate:s.discountRate,learningRate:s.learningRate,plot:{series:["mean / ep"],xLabel:"Iteration ".concat(s.name),yLabel:"Rewards"}})}se(e)}),[a]);const ae=te.length>0,ne=(0,j.useRef)();(0,j.useEffect)((()=>{if(te.length>0&&!ne.current){ne.current=[{values:[[],[],[]],series:["min / ep","mean / ep","max / ep"],yLabel:"Steps"}];for(const e of te)ne.current.push({values:[[]],series:e.plot.series,xLabel:e.plot.xLabel,yLabel:e.plot.yLabel})}}),[te]);const[ie,oe]=(0,j.useState)(!1),re=(0,j.useRef)();re.current=ie;const le=(0,j.useCallback)((async e=>{s.data.stopRequested[0]=e?1:0,e&&await s.call("stop"),oe(e)}),[s]);(0,j.useEffect)((()=>{const e=async e=>{let{data:t}=e;const{caller:a,func:n,params:i}=t;if(!a)if("modelDeleted"===n);else if("onStepEnd"===n)q(...i);else if("onEpisodeEnd"===n)W(...i);else if("onIterationEnd"===n){const[e,t,a,n,o,r,l,c]=i;if(Z(e,t),e>0){C("".concat(r.toFixed(1)," steps/s")),T("".concat(n.toFixed(1)," steps/ep")),G("".concat(c.toFixed(4)," s"));const t=ne.current;t[0].values[0].push({x:e+1,y:a}),t[0].values[1].push({x:e+1,y:n}),t[0].values[2].push({x:e+1,y:o});for(let s=1,a=0;s<ne.current.length;s++,a++){const{rewardsPerEpisode:n,varRewardsPerEpisode:i}=l[a];t[s].values[0].push({x:e+1,y:n})}!function(e){let{values:t,series:s,xLabel:a,yLabel:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let i=0;i<e.length;i++){const{values:t,series:s,xLabel:a,yLabel:n}=e[i],o=document.getElementById("training-plot-container".concat(i));w.render.linechart(o,{values:t,series:s},{xLabel:a||"Training Iteration",yLabel:n,width:400,height:300})}if(t){const e=document.getElementById("game-plot-container");w.render.linechart(e,{values:t,series:s},{xLabel:a||"Training Iteration",yLabel:n,width:400,height:300})}}(t,await s.call("getUIContextPlot"))}}else"onTestStepEnd"===n?U(...i):"onTeachEnd"===n?(le(!0),K(!1)):"onDebugEnd"===n?(le(!0),J(!1)):"onLearnEnd"===n?F(...i):"setGameContext"===n&&ee(i[0])};return s.worker.addEventListener("message",e),()=>{s.worker.removeEventListener("message",e)}}),[W,Z,F,q,U,le,s]);const[ce,de]=(0,j.useState)(1e3),[he,ue]=(0,j.useState)(1),[me,pe]=(0,j.useState)(5e3),ge=(0,j.useCallback)((async e=>{const t=e.target.value.trim(),n=Number(t);if(t!=="".concat(n))d("Number of iteration is not a number"),de(t);else{d("Standing by."),de(n);const e=await s.call("updatePlan",{name:a.name,iterations:n});i(e)}}),[a.name,i,s]),xe=(0,j.useCallback)((async e=>{const t=e.target.value.trim(),n=Number(t);if(t!=="".concat(n))d("Episodes is not a number"),ue(t);else{d("Standing by."),ue(n);const e=await s.call("updatePlan",{name:a.name,episodes:n});i(e)}ue(Number(e.target.value))}),[a.name,i,s]),ye=(0,j.useCallback)((async e=>{const t=e.target.value.trim(),n=Number(t);if(t!=="".concat(n))d("Max steps is not a number"),pe(t);else{d("Standing by."),pe(n);const e=await s.call("updatePlan",{name:a.name,steps:n});i(e)}pe(Number(e.target.value))}),[a.name,i,s]),be=(0,j.useCallback)((async()=>{if(Q)le(!0),_(!1);else{le(!1),_(!0);try{d("Training policy network... Please wait. Network is saved to IndexedDB at the end of each iteration."),await s.call("onResetUIContext"),await n.dA1(),await s.call("train",{trainables:te.map((0,S.A)(["name","path","discountRate","learningRate"])),numIterations:ce,episodesPerIteration:he,maxStepsPerEpisode:me}),re.current?d("Training stopped by user."):d("Training completed.")}catch(e){d("ERROR: ".concat(e.message)),console.error(e)}_(!1)}}),[Q,le,s,te,ce,he,me]),fe=(0,j.useCallback)((async()=>{H?(le(!0),K(!1)):(le(!1),K(!0),await s.call("onResetUIContext"),await n.dA1(),await s.call("teach",{trainables:te.map((0,S.A)(["name","path","discountRate","learningRate"])),maxStepsPerEpisode:me}))}),[H,le,s,te,me]),ve=(0,j.useCallback)((async()=>{if(V)le(!0),X(!1);else{le(!1),X(!0),await n.dA1();const e=await s.call("test",{trainables:te.map((0,S.A)(["name","path","discountRate","learningRate"]))});re.current?d("Test stopped by user after ".concat(e," step(s).")):d("Test finished. Total ".concat(e," step(s).")),X(!1)}}),[V,le,s,te]),we=(0,j.useCallback)((async()=>{Y?(le(!0),J(!1)):(le(!1),J(!0),document.getElementById("env-canvas").focus(),await s.call("debug",{trainables:te.map((0,S.A)(["name","path","discountRate","learningRate"]))}))}),[Y,le,te,s]),Se=(0,j.useRef)(),je=(0,j.useRef)();je.current=Q&&h||H||V||Y,(0,j.useEffect)((()=>{clearTimeout(Se.current);const e=async()=>{l(s.data.learning[0]),je.current&&await(async e=>{const t=document.getElementById("env-canvas");t&&e.render(t)})(t),Se.current&&(Se.current=requestAnimationFrame(e))};return Se.current=requestAnimationFrame(e),()=>{clearTimeout(Se.current),Se.current=null}}),[t,l,s.data.learning]);const Ne=(0,j.useCallback)((async e=>{await s.call("key",{key:e.key})}),[s]);return(0,N.jsxs)("div",{className:"tfjs-example-container centered-container",children:[(0,N.jsx)("section",{children:(0,N.jsxs)("div",{children:[(0,N.jsx)("p",{className:"section-head",children:"Training Parameters"}),(0,N.jsxs)("div",{className:"with-rows",children:[(0,N.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,N.jsxs)("div",{className:"input-div",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{className:"input-label",children:"Number of iterations:"}),(0,N.jsx)("input",{value:ce,onChange:ge,disabled:r})]}),(0,N.jsxs)("div",{className:"input-div",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{className:"input-label",children:"Episodes per iteration:"}),(0,N.jsx)("input",{value:he,onChange:xe,disabled:r})]}),(0,N.jsxs)("div",{className:"input-div",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{className:"input-label",children:"Max. steps per episode:"}),(0,N.jsx)("input",{value:me,onChange:ye,disabled:r})]})]}),(0,N.jsxs)("div",{className:"buttons-section",children:[(0,N.jsx)("button",{style:{marginRight:10},disabled:r||!ae||V||Y||H,onClick:be,children:Q?"Stop":"Train"}),(0,N.jsx)("label",{className:"input-label",children:"Render during training:"}),(0,N.jsx)("input",{id:"render-during-training",type:"checkbox",checked:h,onChange:e=>{u(e.target.checked)}}),(0,N.jsx)("button",{disabled:r||!ae||Q||V||Y,onClick:fe,children:H?"Stop":"Teach"})]})]})]})}),(0,N.jsxs)("section",{children:[(0,N.jsx)("p",{className:"section-head",children:"Training Progress"}),(0,N.jsxs)("div",{className:"with-rows",children:[(0,N.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,N.jsxs)("div",{className:"status",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{children:k}),(0,N.jsx)("progress",{value:z,max:"100"})]}),(0,N.jsxs)("div",{className:"status",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{children:y}),(0,N.jsx)("progress",{value:f,max:"100"})]}),(0,N.jsxs)("div",{className:"status",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{children:m}),(0,N.jsx)("progress",{value:g,max:"100"})]})]}),(0,N.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,N.jsxs)("div",{className:"status",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{children:"Training effect:"}),(0,N.jsx)("span",{className:"status-span",children:A})]}),(0,N.jsxs)("div",{className:"status",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{children:"Training speed:"}),(0,N.jsx)("span",{className:"status-span",children:R})]}),(0,N.jsxs)("div",{className:"status",style:{flexBasis:"33%"},children:[(0,N.jsx)("label",{children:P}),D<100?(0,N.jsx)("progress",{value:D,max:"100"}):(0,N.jsx)("span",{className:"status-span",children:B})]})]}),!!$&&(0,N.jsx)(o,{children:$}),(0,N.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,N.jsx)("div",{id:"training-plot-container0",style:{flexBasis:300}}),te.map(((e,t)=>(0,N.jsx)("div",{id:"training-plot-container".concat(t+1),style:{flexBasis:300}},e.name))),(0,N.jsx)("div",{id:"game-plot-container",style:{flexBasis:300}})]})]})]}),(0,N.jsxs)("section",{children:[(0,N.jsx)("p",{className:"section-head",children:"Status"}),(0,N.jsx)("div",{children:(0,N.jsx)("span",{children:c})})]}),(0,N.jsxs)("section",{children:[(0,N.jsxs)("div",{className:"buttons-section",children:[(0,N.jsx)("button",{style:{marginRight:10},disabled:r||!ae||Q||Y||H,onClick:ve,children:V?"Stop":"Test"}),(0,N.jsx)("button",{disabled:r||!ae||Q||V||H,onClick:we,children:Y?"Stop":"Debug"})]}),(0,N.jsx)("p",{className:"section-head",children:"Simulation"}),(0,N.jsx)("div",{children:(0,N.jsx)("canvas",{id:"env-canvas",height:"600",width:"800",tabIndex:1,onKeyDown:Ne})})]})]})};k.defaultProps={blockUI:!1};const E=e=>{let{trainer:t,plan:s,setPlan:a,model:n,blockUI:i}=e;const[o,r]=(0,j.useState)("Standing by."),[l,c]=(0,j.useState)("128"),[d,h]=(0,j.useState)(.99),[u,m]=(0,j.useState)(.03),p=(0,j.useCallback)((e=>{c(e.target.value)}),[]),g=(0,j.useCallback)((async()=>{try{const e=l.trim().split(",").map((e=>{const t=Number.parseInt(e.trim());if(!(t>0))throw new Error("Invalid hidden layer sizes string: ".concat(l));return t})),i=await t.call("createModel",{plan:s.name,name:n.name,states:n.states,actions:n.actions,hiddenLayerSizesNums:e,discountRate:d,learningRate:u});a((e=>({...e,models:e.models.map((e=>e.name===n.name?i:e))}))),console.log("DONE constructing new instance of SaveablePolicyNetwork")}catch(e){r("ERROR: ".concat(e.message)),console.error(e)}}),[l,s,a,n,t,d,u]),x=(0,j.useCallback)((async()=>{if(confirm("Are you sure you want to delete the locally-stored model?")){const e=await t.call("deleteModel",{plan:s.name,name:n.name});a((t=>({...t,models:t.models.map((t=>t.name===n.name?e:t))})))}}),[t,s,a,n]),y=(0,j.useCallback)(((e,t)=>async()=>{const{policy:s}=await C.loadModel(e,t);w.show.modelSummary({name:"Model Summary",tab:"Model Inspection"},s.model);for(let e=0;e<s.model.layers.length;e++){const t={name:"Layer#".concat(e," Summary"),tab:"Layer Inspection"};w.show.layer(t,s.model.getLayer(void 0,e))}w.visor().open()}),[]),b=(0,j.useCallback)((async e=>{const i=e.target.value.trim(),o=Number(i);if(i!=="".concat(o))r("Discount rate is not a number"),h(i);else{r("Standing by."),h(o);const e=await t.call("updateModel",{plan:s.name,name:n.name,discountRate:o});a((t=>({...t,models:t.models.map((t=>t.name===n.name?e:t))})))}}),[n.name,s.name,a,t]),f=(0,j.useCallback)((async e=>{const i=e.target.value.trim(),o=Number(i);if(i!=="".concat(o))r("Learning rate is not a number"),m(i);else{r("Standing by."),m(o);const e=await t.call("updateModel",{plan:s.name,name:n.name,learningRate:o});a((t=>({...t,models:t.models.map((t=>t.name===n.name?e:t))})))}}),[n.name,s.name,a,t]);(0,j.useEffect)((()=>{c(n.hiddenLayerSizes?n.hiddenLayerSizes.join(","):"128"),h(n.discountRate),m(n.learningRate)}),[n]);const v=(0,j.useMemo)((()=>n.dateSaved?"Saved@".concat(n.dateSaved.toISOString()):"N/A"),[n]);return(0,N.jsx)("div",{className:"tfjs-example-container centered-container",children:(0,N.jsx)("section",{children:(0,N.jsx)("div",{children:(0,N.jsxs)("div",{className:"with-cols",children:[n.name,":",n.states,"x",l,"x",n.actions,(0,N.jsxs)("div",{className:"with-cols",children:[(0,N.jsxs)("div",{className:"with-rows",children:[(0,N.jsx)("p",{className:"section-head",children:"Initialize Model"}),(0,N.jsxs)("div",{className:"with-cols",children:[(0,N.jsxs)("div",{className:"with-rows init-model",children:[(0,N.jsxs)("div",{className:"input-div with-rows",children:[(0,N.jsx)("label",{className:"input-label",children:"Hidden layer size(s):"}),(0,N.jsx)("input",{placeholder:'e.g.: "256", "32,64"',value:l,disabled:i||!!n.hiddenLayerSizes,onChange:p})]}),(0,N.jsx)("button",{disabled:i||"number"!==typeof d||"number"!==typeof u,onClick:g,children:"Create model"})]}),(0,N.jsxs)("div",{className:"with-rows init-model",children:[(0,N.jsxs)("div",{className:"input-div with-rows",children:[(0,N.jsx)("label",{className:"input-label",children:"Locally-stored model"}),(0,N.jsx)("input",{value:v,disabled:!0,readOnly:!0})]}),(0,N.jsx)("button",{disabled:i||!n.path,onClick:x,children:"Delete stored model"})]})]})]}),(0,N.jsxs)("div",{className:"with-rows",children:[(0,N.jsx)("p",{className:"section-head",children:"Training Parameters"}),(0,N.jsxs)("div",{className:"with-cols",children:[(0,N.jsxs)("div",{className:"input-div with-rows init-model",children:[(0,N.jsx)("label",{className:"input-label",children:"Reward discount rate:"}),(0,N.jsx)("input",{value:d,onChange:b,disabled:i}),(0,N.jsx)("button",{className:"input-div",disabled:i||!n.path,onClick:y(n.path,n.name),children:"View stored model"})]}),(0,N.jsxs)("div",{className:"input-div with-rows init-model",children:[(0,N.jsx)("label",{className:"input-label",children:"Learning rate:"}),(0,N.jsx)("input",{value:u,onChange:f,disabled:i})]})]})]}),(0,N.jsxs)("div",{className:"with-rows",children:[(0,N.jsx)("p",{className:"section-head",children:"Status"}),(0,N.jsx)("div",{children:(0,N.jsx)("span",{children:o})})]})]})]})})})})};E.defaultProps={blockUI:!1};const{Game:R,GamePolicyNetwork:C,GameTrainingPlan:M,GameContextRenderer:A,createTrainable:T,createGameContext:P}=a;new R(!0)},73718:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});const a=e=>e?new Promise(((t,s)=>{e.onsuccess=e=>{let{target:s}=e;return t(s.result)},e.onerror=e=>{let{target:t}=e;return s(t.result)}})):Promise.resolve(e),n=(e,t)=>new Promise(((s,n)=>{const i=indexedDB.open(e,1);i.onerror=e=>{console.error("Dastabase Request error",e),n(e)},i.onsuccess=e=>{const t=e.target.result;console.log("Database Request onsuccess",t),t.onerror=e=>{console.error("Database error: ".concat(e.target.errorCode),e.target)},s((async(e,s,n)=>{const i=t.transaction(t.objectStoreNames,"readwrite").objectStore(e);if("string"===typeof s){const e=i.index(s);return await a(n(i,e))}return n=s,await a(n(i))}))},i.onupgradeneeded=e=>{const s=e.target.result;console.log("Request onupgradeneeded",s),t(s)}}))},85817:()=>{},18590:()=>{},4530:()=>{},8108:()=>{},80551:()=>{},41234:()=>{}}]);